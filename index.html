<!-- Сборка 17 -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Оракул</title>
  <style>
    /* Базовая верстка — не менять без разрешения */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-image: url('background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    header {
      position: fixed;
      top: 10px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1000;
    }

    header img { max-height: 40px; margin: 2px 0; }
    header .build { font-size: 12px; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.7); }

    /* По умолчанию контейнер центрирует контент.
       Для экранов, где нужно разместить основной объект в верхней части,
       мы применяем класс .top-screen — только он изменяет вертикальное выравнивание. */
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      margin-top: 80px;
    }

    /* Класс, который сдвигает содержимое к верхней части экрана.
       Применён только к тем экранам, которые ты попросил: sphere, cookie, tarot, zodiac detail. */
    .top-screen {
      justify-content: flex-start;
      padding-top: 80px; /* позиционирование от верхней части — одинаково для всех этих экранов */
    }

    .icon-grid {
      display: grid;
      grid-template-columns: repeat(2, 100px);
      grid-gap: 20px;
      justify-content: center;
      align-items: center;
    }
    .icon-grid img { width: 100px; height: 100px; cursor: pointer; }

    .cookie-image {
      width: 180px;
      max-width: 250px;
      margin-bottom: 20px;
      transition: transform 0.5s ease;
    }
    .cookie-image.opened { transform: scale(1.2) rotate(-5deg); }

    .fortune, .sphere-text, .tarot-text, .zodiac-text {
      font-size: 18px;
      color: #fff;
      text-shadow: 0 2px 5px rgba(0,0,0,0.8);
      margin-top: 20px;
      padding: 0 15px;
      max-height: 200px;
      overflow-y: auto;
    }

    .back-button {
      position: fixed;
      top: 10px;
      left: 10px;
      background: transparent;
      border: none;
      cursor: pointer;
      z-index: 1001;
    }
    .back-button img { width: 40px; height: 40px; }

    /* Шар: базовый размер 200px, при достаточной ширине экрана — 1.5× = 300px */
    .sphere-image {
      width: 200px;    /* оригинальный размер */
      height: auto;
      cursor: pointer;
      display: block;
    }
    @media (min-width: 360px) {
      /* если ширина экрана позволяет (>=360px), увеличиваем до 300px */
      .sphere-image { width: 300px; }
    }

    .tarot-container { display: flex; gap: 15px; margin-top: 8px; } /* небольшая корректировка, позиция берётся от .top-screen */
    .tarot-card img { width: 100px; cursor: pointer; }

    /* Гороскоп — сетка 3 колонки, на всю ширину с отступом */
    .zodiac-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 0 12px;
      justify-items: center;
      align-items: center;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
    .zodiac-grid img {
      width: 100%;
      aspect-ratio: 1 / 1; /* квадрат */
      object-fit: contain;  /* без искажений */
      cursor: pointer;
    }

    /* Деталь зодиака — та же позиция, что и шар: квадратный контейнер, object-fit:contain */
    #zodiacDetailImg {
      width: 200px; /* совпадает по горизонтали с шаром по центру; размер можно подстраивать выше при media query, но не меняю — шар контролирует визу */
      height: 200px;
      object-fit: contain;
      display: block;
      margin-bottom: 20px;
    }

    /* Обеспечиваем, что элементы в top-screen (cookie, tarot cards, zodiac detail) будут размещаться одинаково */
    /* Ничего больше не меняю. */
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Логотип">
  <img src="name.png" alt="Название">
  <div class="build">Сборка 17</div>
</header>

<!-- Главный экран -->
<div id="mainScreen" class="container">
  <div class="icon-grid">
    <img src="sphere.png" alt="Шар" onclick="showScreen('sphereScreen')">
    <img src="cookie.png" alt="Печенье" onclick="showScreen('cookieScreen')">
    <img src="tarot.png" alt="Таро" onclick="showScreen('tarotScreen')">
    <img src="zodiac.png" alt="Зодиак" onclick="showScreen('zodiacScreen')">
  </div>
</div>

<!-- Экран печенья (теперь использует top-screen — точная позиция совпадает с шаром) -->
<div id="cookieScreen" class="container top-screen" style="display:none;">
  <button class="back-button" onclick="backToMain()"><img src="back.png" alt="Назад"></button>
  <!-- Позиция этого изображения совпадает с позицией шара на экране шара благодаря top-screen -->
  <img id="cookieImage" class="cookie-image" src="cookie_closed.png" alt="Печенье" onclick="openCookie()">
  <div class="fortune" id="fortune"></div>
  <!-- reload остаётся как раньше; появление контролируем скриптом -->
  <button id="reloadButton" class="reload-button" style="display:none; background:transparent; border:none; margin-top:15px; cursor:pointer;" onclick="resetCookie()">
    <img src="reload.png" alt="Перезагрузить" style="width:40px; height:40px;">
  </button>
</div>

<!-- Экран шара (top-screen) — шар выводится в верхней части и центрируется по горизонтали -->
<div id="sphereScreen" class="container top-screen" style="display:none;">
  <button class="back-button" onclick="backToMain()"><img src="back.png" alt="Назад"></button>
  <img src="sphere.png" alt="Шар" class="sphere-image" onclick="showSpherePrediction()">
  <div class="sphere-text" id="sphereText"></div>
</div>

<!-- Экран Таро (top-screen — карты будут располагаться в том же вертикальном положении, что и шар) -->
<div id="tarotScreen" class="container top-screen" style="display:none;">
  <button class="back-button" onclick="backToMain()"><img src="back.png" alt="Назад"></button>
  <div class="tarot-container">
    <div class="tarot-card" onclick="openTarotCard(this,1)"><img src="close.png" alt="Таро 1"></div>
    <div class="tarot-card" onclick="openTarotCard(this,2)"><img src="close.png" alt="Таро 2"></div>
    <div class="tarot-card" onclick="openTarotCard(this,3)"><img src="close.png" alt="Таро 3"></div>
  </div>
  <div class="tarot-text" id="tarotText"></div>
</div>

<!-- Экран Зодиака (сетка) -->
<div id="zodiacScreen" class="container" style="display:none;">
  <button class="back-button" onclick="backToMain()"><img src="back.png" alt="Назад"></button>
  <div class="zodiac-grid" id="zodiacGrid"></div>
</div>

<!-- Экран прогноза зодиака (деталь) — top-screen, картинка в том же месте, что и шар -->
<div id="zodiacDetailScreen" class="container top-screen" style="display:none;">
  <button class="back-button" onclick="backToZodiac()"><img src="back.png" alt="Назад"></button>
  <img id="zodiacDetailImg" src="" alt="Знак">
  <div class="zodiac-text" id="zodiacText"></div>
</div>

<script>
  /* Загружает JSON-файлы, как и было в базе (ничего здесь не менял, кроме вывода зодиака: беру .text, если объект) */
  let predictions = [];
  let spherePredictions = [];
  let tarotPredictions = [];
  let zodiacPredictions = [];

  fetch('predictions.json').then(r=>r.json()).then(d=>predictions=d).catch(()=>{predictions=[]});
  fetch('sphere_predictions.json').then(r=>r.json()).then(d=>spherePredictions=d).catch(()=>{spherePredictions=[]});
  fetch('tarot_predictions.json').then(r=>r.json()).then(d=>tarotPredictions=d).catch(()=>{tarotPredictions=[]});
  fetch('zodiac_predictions.json').then(r=>r.json()).then(d=>zodiacPredictions=d).catch(()=>{zodiacPredictions=[]});

  function showScreen(id){
    document.querySelectorAll('.container').forEach(c=>c.style.display="none");
    document.getElementById(id).style.display="flex";
  }
  function backToMain(){
    document.querySelectorAll('.container').forEach(c=>c.style.display="none");
    document.getElementById('mainScreen').style.display="flex";
  }

  /* ------------------ ПЕЧЕНЬЕ ------------------ */
  function openCookie(){
    const img = document.getElementById("cookieImage");
    const fortune = document.getElementById("fortune");
    const reloadBtn = document.getElementById("reloadButton");
    img.src = "cookie_open.png";
    img.classList.add("opened");
    if(predictions.length > 0){
      const idx = Math.floor(Math.random() * predictions.length);
      // predictions может быть массивом строк или объектов
      let p = predictions[idx];
      if(typeof p === "object" && p !== null && p.text) p = p.text;
      fortune.textContent = p;
    } else {
      fortune.textContent = "Предсказание недоступно";
    }
    fortune.classList.add("show");
    // показываем кнопку перезагрузки только после открытия
    reloadBtn.style.display = "inline-block";
  }

  function resetCookie(){
    const img = document.getElementById("cookieImage");
    const fortune = document.getElementById("fortune");
    const reloadBtn = document.getElementById("reloadButton");
    img.src = "cookie_closed.png";
    img.classList.remove("opened");
    fortune.textContent = "";
    fortune.classList.remove("show");
    reloadBtn.style.display = "none";
  }

  /* ------------------ ШАР ------------------ */
  const sphereText = document.getElementById("sphereText");
  function showSpherePrediction(){
    if(spherePredictions.length > 0){
      const idx = Math.floor(Math.random() * spherePredictions.length);
      let p = spherePredictions[idx];
      if(typeof p === "object" && p !== null && p.text) p = p.text;
      sphereText.textContent = p;
    } else {
      sphereText.textContent = "Предсказание недоступно";
    }
    sphereText.classList.add("show");
  }

  // тряска устройства — также вызывает предсказание
  let lastX=null, lastY=null, lastZ=null;
  window.addEventListener("devicemotion", (e) => {
    const acc = e.accelerationIncludingGravity || {};
    const x = acc.x || 0, y = acc.y || 0, z = acc.z || 0;
    if(lastX !== null){
      const dx = Math.abs(x - lastX);
      const dy = Math.abs(y - lastY);
      const dz = Math.abs(z - lastZ);
      const speed = dx + dy + dz;
      if(speed > 25){
        // только если сейчас отображён экран сферы
        if(document.getElementById("sphereScreen").style.display === "flex"){
          showSpherePrediction();
        }
      }
    }
    lastX = x; lastY = y; lastZ = z;
  });

  /* ------------------ ТАРО ------------------ */
  let openedCards = 0;
  function openTarotCard(container, num){
    const img = container.querySelector("img");
    if(img && img.src.includes("close.png")){
      img.src = `open${num}.png`;
      openedCards++;
      if(openedCards === 3){
        const tariffEl = document.getElementById("tarotText");
        if(tarotPredictions.length > 0){
          // tarotPredictions может быть массивом объектов {card,text} или строк
          const html = tarotPredictions.map(p=>{
            let txt = (typeof p === "object" && p !== null && p.text) ? p.text : p;
            return `<p>${txt}</p>`;
          }).join("");
          tariffEl.innerHTML = html;
        } else {
          tariffEl.textContent = "Толкование недоступно";
        }
        tariffEl.classList.add("show");
      }
    }
  }

  /* ------------------ ЗОДИАК ------------------ */
  const zodiacGrid = document.getElementById("zodiacGrid");
  for(let i=1; i<=12; i++){
    const img = document.createElement("img");
    img.src = `Group (${i}).png`;
    img.alt = `Знак ${i}`;
    img.onclick = ()=> openZodiacDetail(i);
    zodiacGrid.appendChild(img);
  }

  function openZodiacDetail(i){
    document.querySelectorAll('.container').forEach(c=>c.style.display="none");
    document.getElementById("zodiacDetailScreen").style.display = "flex";
    document.getElementById("zodiacDetailImg").src = `Group (${i}).png`;

    // zodiacPredictions может быть массив строк или массив объектов {text: "..."}
    if(zodiacPredictions.length >= i){
      let entry = zodiacPredictions[i-1];
      if(typeof entry === "object" && entry !== null && entry.text) entry = entry.text;
      document.getElementById("zodiacText").textContent = entry;
    } else {
      document.getElementById("zodiacText").textContent = "Прогноз недоступен";
    }
  }

  function backToZodiac(){
    document.querySelectorAll('.container').forEach(c=>c.style.display="none");
    document.getElementById('zodiacScreen').style.display = "flex";
  }

  // По умолчанию показываем главный экран
  document.getElementById('mainScreen').style.display = 'flex';
</script>

</body>
</html>
